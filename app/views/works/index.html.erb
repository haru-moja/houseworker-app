<%= render "shared/header" %>
<div class="work_buton">
<%= link_to 'お仕事を発注する', new_home_work_path(@home.id), class: "work-up" %>
</div>
<% if current_user.works %>
  <div class="works_index">
    <% current_user.works.each do |work| %>
      <div class="work_contents">
        <%= work.title %> <br>
        <% if work.images.count > 0 %>
            <%= link_to image_tag(work.images.first.variant(resize: "150x150").processed),home_work_path(@home.id, work.id), class: "won" %> <br>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<h1><%= @home.name %></h1>

<table>
  <thead>
    <tr>
      <th>お仕事一覧</th>
      <th>予定日時</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @home.works.each do |work| %>
      <tr>
        <% if user_signed_in? && current_user.id == work.user_id %>
          <td><%= link_to work.title, home_work_path(@home.id, work.id),class: "work-up" %></td>
          <td><%= link_to '編集する', edit_home_work_path(@home.id, work.id) %></td>
          <td><%= link_to '削除する',home_work_path(@home.id, work.id), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% elsif user_signed_in? && work.complete == nil %>
          <td><%= link_to work.title, home_work_path(@home.id, work.id),class: "work-up" %></td>
          <td><%= work.start_time.strftime("%Y-%m-%d %H:%M") %></td>
          <td><%= link_to 'お仕事を受ける', home_work_path(@home.id, work.id) %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= month_calendar events: @home.works do |date, works| %>
  <%= date.day %>

  <% works.each do |work| %>
    <div>
      <%= link_to work.title, home_work_path(@home.id, work.id) %>
    </div>
  <% end %>
<% end %>
